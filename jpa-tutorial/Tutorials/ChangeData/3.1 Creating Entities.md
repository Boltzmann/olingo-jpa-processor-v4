#3.1 Creating Entities
As the first modifying request we want to have a closer look at creating entities. _JPAODataCRUDHandler_ was designed to take over a repetitive work like preparing the changes or creating the response depending on the request header. The business logic itself has to be implemented in a class that extends _JPAAbstractCUDRequestHandler_, we want to call it _CUDRequestHandler_, locate it in our new package _tutorial.modify_ and overwrite method _createEntity_. The method has three parameter.  
1. _et_ is an instance of _JPAEntityType_, which provides a bunch of information about the entity to be created. This starts with internal (name of POJO) and external name (name of OData entity) and ends with a list of attributes and keys.
2. _jpaAttributes_ is a map of attributes that are provided by the request. Keys of the map are the attribute names of the POJO. In case of complex/embedded attributes jpaAttributes is deep meaning the attribute is an other map. 
3. _em_ is an instance of EntityManager. A transaction has already been started, which is done to ensure the transactional integrity required for change sets within $batch requests.  
The method shall returns an instance of the newly created POJO.  

So lets start creating a new AdministrativeDivision. As a first step we generate setter and getter methods. This can be done in Eclipse after opening _AdministrativeDivision.java_ by choosing _Alt+Shift+S_ and then _Generate Getters and Setters..._ select all others then _children_ and _parent_. Please note that all attributes should be typed with wrapper classes instead of primitive types.

Having done that we can start with a simple implementation of our create method. Here we will simply take the values out of the map and put them into a new POJO instance:

```Java
package tutorial.modify;

import java.util.Map;

import javax.persistence.EntityManager;

import com.sap.olingo.jpa.metadata.core.edm.mapper.api.JPAEntityType;
import com.sap.olingo.jpa.processor.core.api.JPAAbstractCUDRequestHandler;
import com.sap.olingo.jpa.processor.core.exception.ODataJPAProcessException;

import tutorial.model.AdministrativeDivision;

public class CUDRequestHandler extends JPAAbstractCUDRequestHandler {

	@Override
	public Object createEntity(JPAEntityType et, Map<String, Object> jpaAttributes, EntityManager em)
			throws ODataJPAProcessException {

		if (et.getExternalName().equals("AdministrativeDivision")) {
			AdministrativeDivision result = new AdministrativeDivision();

			result.setCodeID((String) jpaAttributes.get("codeID"));
			result.setCodePublisher((String) jpaAttributes.get("codePublisher"));
			result.setDivisionCode((String) jpaAttributes.get("divisionCode"));

			result.setCountryCode((String) jpaAttributes.get("countryCode"));
			result.setParentCodeID((String) jpaAttributes.get("parentCodeID"));
			result.setParentDivisionCode((String) jpaAttributes.get("parentDivisionCode"));

			result.setAlternativeCode((String) jpaAttributes.get("alternativeCode"));
			result.setArea((Integer) jpaAttributes.get("area"));
			result.setPopulation((Long) jpaAttributes.get("population"));
			return result;
		} else {
			return super.createEntity(et, jpaAttributes, em);
		}
	}

}
```  
As the last step before we can test our implementation, we have to make a small change at the Service implementation. Up to know we haven't provided the _JPAODataCRUDHandler_ which is our handler implementation. So we have to add _handler.getJPAODataContext().setCUDRequestHandler(new CUDRequestHandler());_:

```Java
...
			JPAODataCRUDHandler handler = new JPAODataCRUDHandler(PUNIT_NAME,
					DataSourceHelper.createDataSource(DataSourceHelper.DB_HSQLDB));
			handler.getJPAODataContext().setCUDRequestHandler(new CUDRequestHandler());
			handler.process(req, resp);
		} catch (RuntimeException e) {
...		
```  




    {
        "CodePublisher": "Eurostat",
        "CodeID": "NUTS1",
        "DivisionCode": "DE1",
        "CountryCode": "DEU"
    }

![Run on Server](Images/CreateAdminDiv.png)    

    {  
        "CodePublisher": "Eurostat",  
        "CodeID": "NUTS2",  
        "DivisionCode": "DE11",  
        "CountryCode": "DEU",  
        "ParentDivisionCode": "DE1",  
        "ParentCodeID": "NUTS2"  
    }  


__Please note__ that we have used a simplified model for this tutorial where we map a database field one to one to a property in our API. This is not recommended, as this could make a database change to an API change.

